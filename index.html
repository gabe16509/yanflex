<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Yanflex - Profissional</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <style>
        :root { --border-color: #000; --accent-color: #007bff; }
        * { box-sizing: border-box; }
        
        body { font-family: Arial, sans-serif; display: flex; flex-direction: column; align-items: center; padding: 10px; background-color: #f4f4f4; margin: 0; }
        .wrapper { width: 790px; background-color: #fff; }

        .header-fixo { display: flex; background-color: #fff; border: 2px solid var(--border-color); width: 100%; margin-bottom: 15px; }
        .empresa-info { flex: 1.5; padding: 8px; text-align: center; border-right: 2px solid var(--border-color); }
        .empresa-info h1 { font-size: 17px; margin: 0; text-transform: uppercase; }
        .empresa-info p { font-size: 13px; margin: 2px 0; font-weight: bold; }
        .contato-info { flex: 1; padding: 8px; font-size: 11px; line-height: 1.3; }

        .tabs-nav { display: flex; gap: 5px; padding-left: 5px; width: 790px; }
        .tab-btn { padding: 8px 20px; cursor: pointer; border: 2px solid var(--border-color); border-bottom: none; background: #d1d1d1; font-weight: bold; text-transform: uppercase; font-size: 11px; border-radius: 6px 6px 0 0; }
        .tab-btn.active { background: #fff; position: relative; z-index: 2; margin-bottom: -2px; }

        .content-container { background-color: #fff; border: 2px solid var(--border-color); width: 100%; min-height: 600px; position: relative; z-index: 1; }
        .tab-content { display: none; padding: 20px; }
        .tab-content.active { display: block; }
        
        .form-papel { display: flex; gap: 20px; align-items: flex-end; }
        .campo-linha { display: flex; border-bottom: 1px solid #000; flex: 1; align-items: flex-end; padding-bottom: 2px; }
        .label { font-weight: bold; font-size: 13px; margin-right: 8px; text-transform: uppercase; }
        .form-papel input { border: none; outline: none; background: transparent; font-family: inherit; font-size: 14px; width: 100%; }

        .lista-dados { margin-top: 30px; border-top: 1px dashed #ccc; padding-top: 10px; }
        .item-lista { display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid #eee; font-size: 14px; cursor: pointer; transition: background 0.2s; }
        .item-lista:hover { background-color: #f9f9f9; }
        .item-lista.selecionado { background-color: #e7f3ff; border-left: 5px solid var(--accent-color); font-weight: bold; }

        .controles { margin-top: 20px; display: flex; gap: 10px; justify-content: center; }
        .btn-acao { padding: 10px 25px; font-weight: bold; cursor: pointer; border: 2px solid #000; background: #fff; text-transform: uppercase; }
        .btn-add { background: #000; color: #fff; padding: 5px 15px; cursor: pointer; border: none; text-transform: uppercase; font-size: 11px; font-weight: bold; }

        @media print { 
            @page { margin: 1cm; }
            body { background-color: #fff; padding: 0; }
            .wrapper { width: 100%; border: none; }
            .tabs-nav, .controles, .btn-add { display: none !important; } 
            .content-container { border: 2px solid #000; }
        }
    </style>
</head>
<body>

    <div class="wrapper">
        <header class="header-fixo">
            <div class="empresa-info">
                <h1>MZ Comércio e Serviços</h1>
                <p>YANFLEX</p>
                <p>Mangueiras e Conexões Hidráulicas</p>
                <p>CNPJ: 18.502.457/0001-60</p>
            </div>
            <div class="contato-info">
                <strong>End:</strong> Rua N, Quadra 121 - Box 14 Área Industrial<br>
                Monte Dourado - PA | CEP: 68.240-00<br>
                <strong>Fone:</strong> (96) 99122-5729
            </div>
        </header>

        <nav class="tabs-nav">
            <button id="btn-tab-clientes" class="tab-btn active" onclick="abrirAba(event, 'clientes')">Clientes</button>
            <button id="btn-tab-notas" class="tab-btn" onclick="abrirAba(event, 'notas')">Notas</button>
            <button id="btn-tab-produtos" class="tab-btn" onclick="abrirAba(event, 'produtos')">Produtos</button>
        </nav>

        <div class="content-container">
            <div id="clientes" class="tab-content active">
                <div class="form-papel">
                    <div class="campo-linha">
                        <span class="label">Nome:</span>
                        <input type="text" id="cli-nome">
                    </div>
                    <div class="campo-linha" style="max-width: 200px;">
                        <span class="label">Telefone:</span>
                        <input type="text" id="cli-fone" placeholder="(00) 00000-0000">
                    </div>
                    <button class="btn-add" onclick="adicionarCliente()">Adicionar</button>
                </div>
                <div class="lista-dados" id="lista-clientes"></div>
            </div>

            <div id="notas" class="tab-content">
                <h3 id="nota-cliente-info" style="margin-top: 0; color: var(--accent-color);">Nenhum cliente selecionado</h3>
                <div class="form-papel">
                    <div class="campo-linha">
                        <span class="label">Data:</span>
                        <input type="date" id="nota-data">
                    </div>
                    <button class="btn-add" onclick="adicionarNota()">Salvar Nota</button>
                </div>
                <div class="lista-dados" id="lista-notas"></div>
            </div>
            
            <div id="produtos" class="tab-content">
                <h3 id="produto-nota-info" style="margin-top: 0; color: var(--accent-color);">Nenhuma nota selecionada</h3>
                <div class="form-papel">
                    <div class="campo-linha">
                        <span class="label">Descrição:</span>
                        <input type="text" id="prod-desc">
                    </div>
                    <div class="campo-linha" style="max-width: 150px;">
                        <span class="label">Preço:</span>
                        <input type="text" id="prod-preco" placeholder="0.00">
                    </div>
                    <button class="btn-add" onclick="adicionarProduto()">Adicionar</button>
                </div>
                <div class="lista-dados" id="lista-produtos"></div>
            </div>
        </div> 
    </div>

    <div class="controles">
        <button class="btn-acao" onclick="location.reload()">Limpar Tudo</button>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyD84TNeKpXJb9sIaJGucg9mTWSuEKudkXY",
            authDomain: "yanflex-aa831.firebaseapp.com",
            databaseURL: "https://yanflex-aa831-default-rtdb.firebaseio.com",
            projectId: "yanflex-aa831",
            storageBucket: "yanflex-aa831.firebasestorage.app",
            messagingSenderId: "681248148266",
            appId: "1:681248148266:web:cdd077e4f6590d20b82c53",
            measurementId: "G-E2SKKRTSWJ"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let clienteSelecionado = null;
        let notaSelecionada = null;

        // Define a data atual no input
        document.getElementById('nota-data').valueAsDate = new Date();

        function abrirAba(evt, abaNome) {
            if (abaNome === 'notas' && !clienteSelecionado) {
                alert("Por favor, selecione um cliente primeiro!");
                return;
            }
            if (abaNome === 'produtos' && !notaSelecionada) {
                alert("Por favor, selecione uma nota primeiro!");
                return;
            }

            if (abaNome === 'notas') carregarNotas();
            if (abaNome === 'produtos') carregarProdutos();

            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
                tabcontent[i].classList.remove("active");
            }
            tablinks = document.getElementsByClassName("tab-btn");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].classList.remove("active");
            }
            document.getElementById(abaNome).style.display = "block";
            document.getElementById(abaNome).classList.add("active");
            
            const target = evt.currentTarget || document.getElementById('btn-tab-' + abaNome);
            target.classList.add("active");
        }

        function selecionarCliente(id, nome) {
            clienteSelecionado = { id, nome };
            notaSelecionada = null;
            document.getElementById('nota-cliente-info').innerText = "Notas para: " + nome;
            document.getElementById('produto-nota-info').innerText = "Nenhuma nota selecionada";
            const itens = document.querySelectorAll('#lista-clientes .item-lista');
            itens.forEach(item => item.classList.remove('selecionado'));
            event.currentTarget.classList.add('selecionado');
        }

        function selecionarNota(id, dataNota) {
            notaSelecionada = { id, dataNota };
            document.getElementById('produto-nota-info').innerText = "Produtos da Nota: " + dataNota;
            const itens = document.querySelectorAll('#lista-notas .item-lista');
            itens.forEach(item => item.classList.remove('selecionado'));
            event.currentTarget.classList.add('selecionado');
        }

        function adicionarNota() {
            const dataNota = document.getElementById('nota-data').value;
            if (!dataNota) return alert("Preencha a Data da nota!");

            database.ref('notas/' + clienteSelecionado.id).push({
                dataNota, total: "0.00"
            }).then(() => {
                document.getElementById('nota-data').valueAsDate = new Date();
            });
        }

        function carregarNotas() {
            database.ref('notas/' + clienteSelecionado.id).on('value', (snapshot) => {
                const lista = document.getElementById('lista-notas');
                lista.innerHTML = "";
                snapshot.forEach((child) => {
                    const nota = child.val();
                    const item = document.createElement('div');
                    item.className = 'item-lista';
                    if(notaSelecionada && notaSelecionada.id === child.key) item.classList.add('selecionado');
                    item.onclick = (e) => selecionarNota(child.key, nota.dataNota);
                    item.ondblclick = (e) => {
                        selecionarNota(child.key, nota.dataNota);
                        abrirAba({currentTarget: document.getElementById('btn-tab-produtos')}, 'produtos');
                    };
                    item.innerHTML = `<span>Data: ${nota.dataNota}</span> <strong>Total: R$ ${nota.total}</strong>`;
                    lista.appendChild(item);
                });
            });
        }

        function adicionarCliente() {
            const nome = document.getElementById('cli-nome').value;
            const fone = document.getElementById('cli-fone').value;
            if (!nome || !fone) return alert("Preencha Nome e Telefone!");
            database.ref('clientes').push({ nome, fone }).then(() => {
                document.getElementById('cli-nome').value = "";
                document.getElementById('cli-fone').value = "";
            });
        }

        database.ref('clientes').on('value', (snapshot) => {
            const lista = document.getElementById('lista-clientes');
            lista.innerHTML = "";
            snapshot.forEach((child) => {
                const cli = child.val();
                const item = document.createElement('div');
                item.className = 'item-lista';
                if(clienteSelecionado && clienteSelecionado.id === child.key) item.classList.add('selecionado');
                item.onclick = (e) => selecionarCliente(child.key, cli.nome);
                item.ondblclick = (e) => {
                    selecionarCliente(child.key, cli.nome);
                    abrirAba({currentTarget: document.getElementById('btn-tab-notas')}, 'notas');
                };
                item.innerHTML = `<span>${cli.nome}</span> <strong>${cli.fone}</strong>`;
                lista.appendChild(item);
            });
        });

        function adicionarProduto() {
            const desc = document.getElementById('prod-desc').value;
            const precoStr = document.getElementById('prod-preco').value.replace(',', '.');
            const preco = parseFloat(precoStr);

            if (!desc || isNaN(preco)) return alert("Preencha Descrição e Preço corretamente!");
            
            database.ref('produtos/' + notaSelecionada.id).push({ 
                descricao: desc, 
                preco: preco.toFixed(2) 
            }).then(() => {
                document.getElementById('prod-desc').value = "";
                document.getElementById('prod-preco').value = "";
                
                database.ref('produtos/' + notaSelecionada.id).once('value', (snapshot) => {
                    let soma = 0;
                    snapshot.forEach(child => {
                        soma += parseFloat(child.val().preco);
                    });
                    database.ref('notas/' + clienteSelecionado.id + '/' + notaSelecionada.id).update({
                        total: soma.toFixed(2)
                    });
                });
            });
        }

        function carregarProdutos() {
            database.ref('produtos/' + notaSelecionada.id).on('value', (snapshot) => {
                const lista = document.getElementById('lista-produtos');
                lista.innerHTML = "";
                snapshot.forEach((child) => {
                    const prod = child.val();
                    const item = document.createElement('div');
                    item.className = 'item-lista';
                    item.style.cursor = "default";
                    item.innerHTML = `<span>${prod.descricao}</span> <strong>R$ ${prod.preco}</strong>`;
                    lista.appendChild(item);
                });
            });
        }
    </script>
</body>
</html>
